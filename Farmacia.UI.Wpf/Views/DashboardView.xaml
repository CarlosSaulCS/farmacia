<UserControl x:Class="Farmacia.UI.Wpf.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Loaded="UserControl_OnLoaded">
    <UserControl.Resources>
        <LinearGradientBrush x:Key="DashboardHeroBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#F3F6FF" Offset="0" />
            <GradientStop Color="#F9FBFF" Offset="1" />
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="MetricBrushSales" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#F1F5FF" Offset="0" />
            <GradientStop Color="#E3ECFF" Offset="1" />
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="MetricBrushTickets" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#F2FBF6" Offset="0" />
            <GradientStop Color="#E7F7ED" Offset="1" />
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="MetricBrushAlerts" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FFF8F1" Offset="0" />
            <GradientStop Color="#FFEFE4" Offset="1" />
        </LinearGradientBrush>

        <SolidColorBrush x:Key="DashboardAccentBrush" Color="#2563EB" />
        <SolidColorBrush x:Key="DashboardSuccessBrush" Color="#16A34A" />
        <SolidColorBrush x:Key="DashboardWarningBrush" Color="#EA580C" />

        <Style x:Key="DashboardMetricBorderStyle" TargetType="Border" BasedOn="{StaticResource CardStyle}">
            <Setter Property="Padding" Value="24" />
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="MinWidth" Value="240" />
            <Setter Property="Margin" Value="0,0,24,24" />
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#1A1C33" BlurRadius="22" Opacity="0.08" ShadowDepth="6" />
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DashboardMetricLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="#5B6576" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="TextOptions.TextFormattingMode" Value="Display" />
        </Style>

        <Style x:Key="DashboardMetricValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="30" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Foreground" Value="{StaticResource NeutralDarkBrush}" />
            <Setter Property="Margin" Value="0,10,0,6" />
        </Style>

        <Style x:Key="DashboardMetricSubtextStyle" TargetType="TextBlock" BasedOn="{StaticResource CaptionStyle}">
            <Setter Property="Foreground" Value="#6B7280" />
        </Style>

        <Style x:Key="DashboardSectionTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{StaticResource NeutralDarkBrush}" />
        </Style>

        <Style x:Key="DashboardPillStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="18" />
            <Setter Property="Padding" Value="12,6" />
            <Setter Property="Background" Value="#FFFFFFFF" />
            <Setter Property="Opacity" Value="0.86" />
        </Style>

        <Style x:Key="DashboardDataGridHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="#1F2937" />
            <Setter Property="Background" Value="#F5F7FB" />
            <Setter Property="Padding" Value="16,12" />
            <Setter Property="BorderBrush" Value="{StaticResource SeparatorBrush}" />
            <Setter Property="BorderThickness" Value="0,0,0,1" />
        </Style>

        <Style x:Key="DashboardDataGridRowStyle" TargetType="DataGridRow">
            <Setter Property="Height" Value="46" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Foreground" Value="{StaticResource NeutralDarkBrush}" />
            <Setter Property="Margin" Value="0,2,0,0" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#E8EDFF" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <Grid Margin="24,0,24,32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Border Grid.Row="0" Background="{StaticResource DashboardHeroBrush}" CornerRadius="28" Padding="32" Margin="0,0,0,16">
                <Border.Effect>
                    <DropShadowEffect Color="#1A1C33" BlurRadius="28" ShadowDepth="10" Opacity="0.08" />
                </Border.Effect>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2.2*" />
                        <ColumnDefinition Width="1*" />
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="Tablero ejecutivo" FontSize="26" FontWeight="SemiBold" Foreground="#1F2937" />
                        <TextBlock Text="Visión rápida del desempeño diario y focos de atención." Style="{StaticResource CaptionStyle}" Margin="0,8,0,0" />
                    </StackPanel>

                    <StackPanel Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <Border Style="{StaticResource DashboardPillStyle}" Background="#FFFFFF" Padding="20,14">
                            <StackPanel>
                                <TextBlock Text="Ingresos hoy" FontSize="12" FontWeight="SemiBold" Foreground="#64748B" />
                                <TextBlock Text="{Binding TodaySales, StringFormat=C}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource DashboardAccentBrush}" />
                            </StackPanel>
                        </Border>
                        <Border Style="{StaticResource DashboardPillStyle}" Background="#FFFFFF" Padding="20,14" Margin="0,12,0,0">
                            <StackPanel>
                                <TextBlock Text="Alertas activas" FontSize="12" FontWeight="SemiBold" Foreground="#64748B" />
                                <TextBlock Text="{Binding Alerts.Count}" FontSize="20" FontWeight="Bold" Foreground="{StaticResource DashboardWarningBrush}" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </Border>

            <WrapPanel Grid.Row="1" Margin="0,8,0,12" HorizontalAlignment="Stretch">
                <Border Style="{StaticResource DashboardMetricBorderStyle}" Background="{StaticResource MetricBrushSales}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Ventas del día" Style="{StaticResource DashboardMetricLabelStyle}" />
                            <TextBlock Text="{Binding TodaySales, StringFormat=C}" Style="{StaticResource DashboardMetricValueStyle}" />
                            <TextBlock Text="Ingresos acumulados" Style="{StaticResource DashboardMetricSubtextStyle}" />
                        </StackPanel>
                        <Border Grid.Column="1" Width="48" Height="48" CornerRadius="24" Background="#FFFFFF" Opacity="0.85" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <Viewbox Width="28" Height="28" Margin="0">
                                <Path Data="M2,20 L10,12 16,16 26,6" Stroke="{StaticResource DashboardAccentBrush}" StrokeThickness="2.4" StrokeLineJoin="Round" StrokeEndLineCap="Round" StrokeStartLineCap="Round" Fill="Transparent" />
                            </Viewbox>
                        </Border>
                    </Grid>
                </Border>

                <Border Style="{StaticResource DashboardMetricBorderStyle}" Background="{StaticResource MetricBrushTickets}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Tickets" Style="{StaticResource DashboardMetricLabelStyle}" />
                            <TextBlock Text="{Binding TodaySalesCount}" Style="{StaticResource DashboardMetricValueStyle}" />
                            <TextBlock Text="Operaciones registradas" Style="{StaticResource DashboardMetricSubtextStyle}" />
                        </StackPanel>
                        <Border Grid.Column="1" Width="48" Height="48" CornerRadius="24" Background="#FFFFFF" Opacity="0.85" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <Viewbox Width="26" Height="26">
                                <Path Data="M2,4 H22 V24 H2 Z M2,10 H22" Stroke="{StaticResource DashboardSuccessBrush}" StrokeThickness="2.2" StrokeLineJoin="Round" StrokeStartLineCap="Round" StrokeEndLineCap="Round" Fill="Transparent" />
                            </Viewbox>
                        </Border>
                    </Grid>
                </Border>

                <Border Style="{StaticResource DashboardMetricBorderStyle}" Background="{StaticResource MetricBrushAlerts}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Alertas activas" Style="{StaticResource DashboardMetricLabelStyle}" />
                            <TextBlock Text="{Binding Alerts.Count}" Style="{StaticResource DashboardMetricValueStyle}" />
                            <TextBlock Text="Lotes por revisar" Style="{StaticResource DashboardMetricSubtextStyle}" />
                        </StackPanel>
                        <Border Grid.Column="1" Width="48" Height="48" CornerRadius="24" Background="#FFFFFF" Opacity="0.85" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <Viewbox Width="26" Height="26">
                                <Grid>
                                    <Path Data="M14,4 L26,24 H2 Z" Fill="{StaticResource DashboardWarningBrush}" Opacity="0.22" />
                                    <Path Data="M14,8 L22,22 H6 Z" Stroke="{StaticResource DashboardWarningBrush}" StrokeThickness="2.2" StrokeLineJoin="Round" StrokeStartLineCap="Round" StrokeEndLineCap="Round" Fill="Transparent" />
                                    <Rectangle Width="2" Height="7" Fill="{StaticResource DashboardWarningBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,4" />
                                    <Ellipse Width="2.6" Height="2.6" Fill="{StaticResource DashboardWarningBrush}" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,4,0,2" />
                                </Grid>
                            </Viewbox>
                        </Border>
                    </Grid>
                </Border>
            </WrapPanel>

            <Grid Grid.Row="2" Margin="0,8,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Border Grid.Column="0" CornerRadius="30" Padding="0" Background="#FFFFFFFF" Margin="0,0,20,0">
                    <Border.Effect>
                        <DropShadowEffect Color="#1A1C33" BlurRadius="26" ShadowDepth="10" Opacity="0.08" />
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" Background="{StaticResource MetricBrushSales}" CornerRadius="30,30,0,0" Padding="24">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Productos top" Style="{StaticResource DashboardSectionTitleStyle}" />
                                    <TextBlock Text="Mejor desempeño del día" Style="{StaticResource CaptionStyle}" />
                                </StackPanel>
                                <Border Grid.Column="1" Width="46" Height="46" CornerRadius="23" Background="#FFFFFF" Opacity="0.78" HorizontalAlignment="Right" VerticalAlignment="Center">
                                    <Viewbox Width="24" Height="24">
                                        <Path Data="M2,22 L10,12 15,18 26,6" Stroke="{StaticResource DashboardAccentBrush}" StrokeThickness="2.2" StrokeStartLineCap="Round" StrokeEndLineCap="Round" StrokeLineJoin="Round" Fill="Transparent" />
                                    </Viewbox>
                                </Border>
                            </Grid>
                        </Border>

                        <Grid Grid.Row="1" Margin="0,18,0,20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <DataGrid ItemsSource="{Binding TopProducts}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="True"
                                      Style="{StaticResource CardDataGridStyle}"
                                      ColumnHeaderStyle="{StaticResource DashboardDataGridHeaderStyle}"
                                      RowStyle="{StaticResource DashboardDataGridRowStyle}"
                                      BorderThickness="0"
                                      GridLinesVisibility="None">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Producto" Binding="{Binding Name}" Width="*" />
                                    <DataGridTextColumn Header="Cantidad" Binding="{Binding Quantity}" Width="120" />
                                    <DataGridTextColumn Header="Total" Binding="{Binding Total, StringFormat=C}" Width="150" />
                                </DataGrid.Columns>
                            </DataGrid>

                            <Border Grid.Row="1" Background="#F8FAFF" CornerRadius="18" Padding="18,10" Margin="0,18,0,0" HorizontalAlignment="Center">
                                <TextBlock Text="No hay ventas registradas hoy." Foreground="#64748B" FontSize="12" />
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding TopProducts.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>

                <Border Grid.Column="1" CornerRadius="30" Padding="0" Background="#FFFFFFFF">
                    <Border.Effect>
                        <DropShadowEffect Color="#1A1C33" BlurRadius="26" ShadowDepth="10" Opacity="0.08" />
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" Background="{StaticResource MetricBrushAlerts}" CornerRadius="30,30,0,0" Padding="24">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Alertas" Style="{StaticResource DashboardSectionTitleStyle}" />
                                    <TextBlock Text="Lotes próximos a expirar" Style="{StaticResource CaptionStyle}" />
                                </StackPanel>
                                <Border Grid.Column="1" Width="46" Height="46" CornerRadius="23" Background="#FFFFFF" Opacity="0.78" HorizontalAlignment="Right" VerticalAlignment="Center">
                                    <Viewbox Width="24" Height="24">
                                        <Grid>
                                            <Path Data="M12,2 L22,22 H2 Z" Fill="{StaticResource DashboardWarningBrush}" Opacity="0.22" />
                                            <Path Data="M12,5 L19,19 H5 Z" Stroke="{StaticResource DashboardWarningBrush}" StrokeThickness="2.2" StrokeStartLineCap="Round" StrokeEndLineCap="Round" StrokeLineJoin="Round" Fill="Transparent" />
                                            <Rectangle Width="2" Height="6" Fill="{StaticResource DashboardWarningBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,4" />
                                            <Ellipse Width="2.6" Height="2.6" Fill="{StaticResource DashboardWarningBrush}" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,2,0,0" />
                                        </Grid>
                                    </Viewbox>
                                </Border>
                            </Grid>
                        </Border>

                        <Grid Grid.Row="1" Margin="0,18,0,20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <DataGrid ItemsSource="{Binding Alerts}"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="True"
                                      Style="{StaticResource CardDataGridStyle}"
                                      ColumnHeaderStyle="{StaticResource DashboardDataGridHeaderStyle}"
                                      RowStyle="{StaticResource DashboardDataGridRowStyle}"
                                      BorderThickness="0"
                                      GridLinesVisibility="None">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Producto" Binding="{Binding ProductName}" Width="*" />
                                    <DataGridTextColumn Header="Lote" Binding="{Binding LotCode}" Width="110" />
                                    <DataGridTextColumn Header="Caducidad" Binding="{Binding ExpirationDate, StringFormat={}{0:dd MMM yyyy}}" Width="150" />
                                </DataGrid.Columns>
                            </DataGrid>

                            <Border Grid.Row="1" Background="#FFF7ED" CornerRadius="18" Padding="18,10" Margin="0,18,0,0" HorizontalAlignment="Center">
                                <TextBlock Text="Sin alertas activas." Foreground="#C2410C" FontSize="12" />
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Alerts.Count}" Value="0">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </ScrollViewer>
</UserControl>
